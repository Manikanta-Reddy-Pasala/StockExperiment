{% extends "base.html" %}

{% block title %}8-21 EMA Strategy{% endblock %}

{% block content %}
<!-- Header Section -->
<div class="card hover-lift animate-fade-in-up mb-4">
    <div class="card-header bg-gradient-info text-white">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h4 class="card-title mb-0 text-white">
                    <i class="bi bi-graph-up-arrow me-2"></i>8-21 EMA Swing Trading Strategy
                </h4>
                <small class="opacity-75">D_momentum Scoring Model - Backtest-Optimized (PF 3.84, 58.5% WR)</small>
            </div>
            <div>
                <span class="badge bg-success fs-6">
                    <i class="bi bi-check-circle-fill me-1"></i>Active
                </span>
            </div>
        </div>
    </div>
</div>

<!-- Strategy Stats Cards -->
<div class="row g-4 mb-4">
    <div class="col-lg-3 col-md-6">
        <div class="card hover-lift animate-fade-in-up" style="animation-delay: 0.1s;">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="text-muted mb-2 fw-semibold">Total Stocks Analyzed</h6>
                        <h2 class="fw-bold mb-0" id="total-stocks">2,259</h2>
                        <small class="text-primary">
                            <i class="bi bi-database"></i> NSE Stocks
                        </small>
                    </div>
                    <div class="bg-gradient-primary rounded-3 p-3">
                        <i class="bi bi-database text-white fs-3"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="card hover-lift animate-fade-in-up" style="animation-delay: 0.2s;">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="text-muted mb-2 fw-semibold">Buy Signals</h6>
                        <h2 class="fw-bold mb-0 text-success" id="buy-signals">590</h2>
                        <small class="text-success">
                            <i class="bi bi-arrow-up-circle"></i> Power Zone Active
                        </small>
                    </div>
                    <div class="bg-gradient-success rounded-3 p-3">
                        <i class="bi bi-arrow-up-circle text-white fs-3"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="card hover-lift animate-fade-in-up" style="animation-delay: 0.3s;">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="text-muted mb-2 fw-semibold">Sell Signals</h6>
                        <h2 class="fw-bold mb-0 text-danger" id="sell-signals">1,365</h2>
                        <small class="text-danger">
                            <i class="bi bi-arrow-down-circle"></i> Bearish Trend
                        </small>
                    </div>
                    <div class="bg-gradient-danger rounded-3 p-3">
                        <i class="bi bi-arrow-down-circle text-white fs-3"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="col-lg-3 col-md-6">
        <div class="card hover-lift animate-fade-in-up" style="animation-delay: 0.4s;">
            <div class="card-body">
                <div class="d-flex align-items-center">
                    <div class="flex-grow-1">
                        <h6 class="text-muted mb-2 fw-semibold">Strong Buy</h6>
                        <h2 class="fw-bold mb-0 text-info" id="strong-buy">9</h2>
                        <small class="text-info">
                            <i class="bi bi-gem"></i> DeMarker 0.55-0.70
                        </small>
                    </div>
                    <div class="bg-gradient-info rounded-3 p-3">
                        <i class="bi bi-gem text-white fs-3"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Strategy Overview -->
<div class="row g-4 mb-4">
    <div class="col-lg-8">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-info-circle me-2"></i>Strategy Overview
                </h5>
            </div>
            <div class="card-body">
                <div class="alert alert-info mb-4">
                    <h6 class="alert-heading">
                        <i class="bi bi-lightbulb-fill me-2"></i>What is the 8-21 EMA Strategy?
                    </h6>
                    <p class="mb-0">
                        A regime-aware swing trading strategy that identifies both <strong>LONG</strong> and <strong>SHORT</strong> entry points.
                        Detects market regime (bull/bear) using Nifty 50 or market breadth, then generates signals in the appropriate direction.
                    </p>
                </div>

                <h6 class="fw-bold mb-3">Core Components:</h6>

                <div class="mb-4">
                    <h6 class="text-primary">
                        <i class="bi bi-1-circle-fill me-2"></i>Power Zone (Trend Identification)
                    </h6>
                    <p class="ms-4 mb-2">
                        <strong>8 EMA > 21 EMA:</strong> Confirms bullish trend when 8-day EMA crosses above 21-day EMA
                    </p>
                    <p class="ms-4 mb-0 text-muted small">
                        The "Power Zone" indicates strong momentum when price stays above both EMAs.
                    </p>
                </div>

                <div class="mb-4">
                    <h6 class="text-success">
                        <i class="bi bi-2-circle-fill me-2"></i>DeMarker Momentum (Entry Timing) — 50pts weight
                    </h6>
                    <p class="ms-4 mb-2">
                        <strong>DeMarker 0.55-0.70:</strong> Identifies strong buying momentum within uptrend
                    </p>
                    <p class="ms-4 mb-0 text-muted small">
                        Ranges from 0 to 1. Higher values (0.55-0.70) = stronger buying pressure = best entries. This is the #1 scoring factor (50pts). Validated across 13 months of data — momentum beats oversold.
                    </p>
                </div>

                <div class="mb-4">
                    <h6 class="text-warning">
                        <i class="bi bi-3-circle-fill me-2"></i>Fibonacci Extensions (Profit Targets)
                    </h6>
                    <p class="ms-4 mb-2">
                        <strong>Targets:</strong> 127.2%, 161.8%, 200% extensions from recent swing low
                    </p>
                    <p class="ms-4 mb-0 text-muted small">
                        Take partial profits at each Fibonacci level for optimal risk/reward.
                    </p>
                </div>

                <div class="alert alert-warning mb-0">
                    <h6 class="alert-heading">
                        <i class="bi bi-shield-fill-exclamation me-2"></i>Risk Management
                    </h6>
                    <ul class="mb-0">
                        <li><strong>Stop Loss:</strong> Below 21 EMA or recent swing low (5-7%)</li>
                        <li><strong>Position Size:</strong> Max 5% per trade</li>
                        <li><strong>Time Frame:</strong> 10-15 day holds (swing trading)</li>
                        <li><strong>Win Rate:</strong> 58.5% with PF 3.84 (13-month backtest)</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="card shadow-sm">
            <div class="card-header bg-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-gear-fill me-2"></i>Strategy Settings
                </h5>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label fw-semibold">Status</label>
                    <div>
                        <span class="badge bg-success">
                            <i class="bi bi-circle-fill me-1"></i>Active
                        </span>
                    </div>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Type</label>
                    <p class="mb-0">Regime-Aware Technical Analysis (Bull + Bear)</p>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Trading Style</label>
                    <p class="mb-0">Swing Trading (10-15 days)</p>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Target Returns</label>
                    <p class="mb-0">7-12% per trade</p>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Risk per Trade</label>
                    <p class="mb-0">5-7% (Below 21 EMA)</p>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Universe</label>
                    <p class="mb-0">NSE Stocks (2,259 total)</p>
                </div>

                <div class="mb-3">
                    <label class="form-label fw-semibold">Calculation Schedule</label>
                    <p class="mb-0 small text-muted">Daily at 10:00 PM IST</p>
                </div>

                <hr>

                <div class="d-grid gap-2">
                    <a href="/suggested_stocks" class="btn btn-primary">
                        <i class="bi bi-eye-fill me-2"></i>View Stock Picks
                    </a>
                    <button class="btn btn-outline-secondary" disabled>
                        <i class="bi bi-sliders me-2"></i>Configure (Locked)
                    </button>
                </div>

                <div class="alert alert-info mt-3 mb-0 small">
                    <i class="bi bi-info-circle me-1"></i>
                    D_momentum model — optimized via 34,560-param grid search across 13 months. Top 5 picks daily.
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Entry/Exit Rules -->
<div class="row g-4">
    <div class="col-md-6">
        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-arrow-up-circle me-2"></i>Entry Rules
                </h5>
            </div>
            <div class="card-body">
                <ol class="mb-0">
                    <li class="mb-3">
                        <strong>Power Zone Confirmation:</strong> Price must be above both 8 EMA and 21 EMA
                    </li>
                    <li class="mb-3">
                        <strong>Trend Alignment:</strong> 8 EMA must be above 21 EMA (bullish setup)
                    </li>
                    <li class="mb-3">
                        <strong>Timing Signal:</strong> DeMarker oscillator 0.55-0.70 (strong momentum)
                    </li>
                    <li class="mb-3">
                        <strong>Volume Check:</strong> Above average daily volume (50,000+ shares)
                    </li>
                    <li class="mb-0">
                        <strong>Market Cap:</strong> Minimum 500 Cr for liquidity
                    </li>
                </ol>
            </div>
        </div>
    </div>

    <div class="col-md-6">
        <div class="card shadow-sm">
            <div class="card-header bg-danger text-white">
                <h5 class="card-title mb-0">
                    <i class="bi bi-arrow-down-circle me-2"></i>Exit Rules
                </h5>
            </div>
            <div class="card-body">
                <ol class="mb-0">
                    <li class="mb-3">
                        <strong>Profit Targets (Fibonacci):</strong>
                        <ul class="mt-1">
                            <li>Take 33% at 127.2% extension</li>
                            <li>Take 33% at 161.8% extension</li>
                            <li>Take 34% at 200% extension</li>
                        </ul>
                    </li>
                    <li class="mb-3">
                        <strong>Stop Loss:</strong> Exit if price closes below 21 EMA
                    </li>
                    <li class="mb-3">
                        <strong>Time Stop:</strong> Exit after 15 days if no profit target hit
                    </li>
                    <li class="mb-0">
                        <strong>Sell Signal:</strong> Exit immediately if sell signal generated
                    </li>
                </ol>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block scripts %}
<script>
    // Update stats on page load
    document.addEventListener('DOMContentLoaded', function() {
        // Load current statistics from database
        fetch('/api/strategy/stats')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('total-stocks').textContent = data.total_stocks || '2,259';
                    document.getElementById('buy-signals').textContent = data.buy_signals || '590';
                    document.getElementById('sell-signals').textContent = data.sell_signals || '1,365';
                    document.getElementById('strong-buy').textContent = data.strong_buy || '0';
                }
            })
            .catch(error => {
                console.log('Using default statistics');
            });
    });
</script>
{% endblock %}
